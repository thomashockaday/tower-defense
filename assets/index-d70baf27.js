var j=(s,t,i)=>{if(!t.has(s))throw TypeError("Cannot "+i)};var g=(s,t,i)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,i)};var S=(s,t,i)=>(j(s,t,"access private method"),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))e(h);new MutationObserver(h=>{for(const n of h)if(n.type==="childList")for(const R of n.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&e(R)}).observe(document,{childList:!0,subtree:!0});function i(h){const n={};return h.integrity&&(n.integrity=h.integrity),h.referrerPolicy&&(n.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?n.credentials="include":h.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(h){if(h.ep)return;h.ep=!0;const n=i(h);fetch(h.href,n)}})();class x{constructor(t,i,e,h){if(new.target===x)throw new TypeError("Cannot construct Enemy instances directly");this.tilePadding=(e-i)/2,this.position={x:t.x,y:t.y+this.tilePadding},this.width=i,this.height=i,this.center={x:this.position.x+this.width/2,y:this.position.y+this.height/2},this.tileSize=e,this.currentDirection=null,this.nextDirection=null,this.speed=null,this.fullHealth=null,this.health=null,this.coins=null,this.waypoints=h,this.waypointIndex=0}update(){this.center={x:this.position.x+this.width/2,y:this.position.y+this.height/2};const t=this.waypoints[this.waypointIndex],i=t.y-this.center.y,e=t.x-this.center.x,h=Math.atan2(i,e);this.position.x+=Math.cos(h)*this.speed,this.position.y+=Math.sin(h)*this.speed,Math.round(this.center.x)===t.x&&Math.round(this.center.y)===t.y&&this.waypointIndex<this.waypoints.length-1&&this.waypointIndex++}draw(t){t.fillStyle="#c20102",t.fillRect(this.position.x,this.position.y,this.width,this.height);const i=this.health/this.fullHealth*this.width;t.fillStyle="#1e272e",t.fillRect(this.position.x,this.position.y-10,this.width,5),t.fillStyle="#4cd137",t.fillRect(this.position.x,this.position.y-10,i,5)}}class I extends x{constructor(t,i,e){super(t,i-8,i,e),this.speed=2,this.fullHealth=3,this.health=this.fullHealth,this.coins=5}}class $ extends x{constructor(t,i,e){super(t,i-16,i,e),this.speed=4,this.fullHealth=2,this.health=this.fullHealth,this.coins=5}}class D extends x{constructor(t,i,e){super(t,i,i,e),this.speed=2,this.fullHealth=6,this.health=this.fullHealth,this.coins=10}}class v{static rectRect(t,i){return t.position.x<i.position.x+i.width&&t.position.x+t.width>i.position.x&&t.position.y<i.position.y+i.height&&t.position.y+t.height>i.position.y}static circleRect(t,i){return t.position.x>i.position.x&&t.position.x+t.radius<=i.position.x+i.width&&t.position.y>=i.position.y&&t.position.y+t.radius<=i.position.y+i.height}}class A{constructor(t,i,e){this.position=t,this.velocity=i,this.speed=e,this.radius=4,this.finished=!1}update(){this.position.x+=this.velocity.x*this.speed,this.position.y+=this.velocity.y*this.speed}draw(t){t.fillStyle="#0060c1",t.beginPath(),t.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),t.fill()}}var b,O;const L=class{constructor(t,i,e,h){g(this,b);if(new.target===L)throw new TypeError("Cannot construct Tower instances directly");this.position=t,this.width=i,this.height=e,this.radius=h,this.cooldown=null,this.maxBullets=null,this.cost=null,this.damage=null,this.bulletSpeed=null,this.colour=null,this.range={position:{x:this.position.x-Math.floor(this.radius/2)*i,y:this.position.y-Math.floor(this.radius/2)*e},width:this.radius*i,height:this.radius*e},this.bullets=[]}update(t,i){if(t%this.cooldown===0){for(let e=0;e<i.length;e++)if(v.rectRect(i[e],this.range)&&i[e].position.x+i[e].width>0&&this.bullets.length<this.maxBullets){S(this,b,O).call(this,i[e]);break}}for(let e=0;e<this.bullets.length;e++)this.bullets[e].update(),this.bullets[e].finished===!0&&this.bullets.splice(e,1)}draw(t){t.fillStyle=this.colour,t.fillRect(this.position.x,this.position.y,this.width,this.height),t.fillStyle="#FFFF0011",t.fillRect(this.range.position.x,this.range.position.y,this.range.width,this.range.height),this.bullets.forEach(i=>{i.draw(t)})}};let T=L;b=new WeakSet,O=function(t){const i=Math.atan2(t.position.y+t.height/2-(this.position.y+this.height/2),t.position.x+t.width/2-(this.position.x+this.width/2)),e=new A({x:this.position.x+this.width/2,y:this.position.y+this.height/2},{x:Math.cos(i),y:Math.sin(i)},this.bulletSpeed);this.bullets.push(e)};class G extends T{constructor(t,i,e){super(t,i,e,7),this.cooldown=40,this.maxBullets=2,this.cost=20,this.damage=5,this.bulletSpeed=50,this.colour="coral"}}class q{constructor(t){this.screen=t}}class Y{constructor(){this.tiles=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,2,2,2,0,0,0,0],[0,0,2,0,0,0,0,2,0,0,0,0],[0,0,2,9,0,0,0,2,0,2,2,3],[0,0,2,0,0,0,0,2,0,2,0,0],[0,0,2,0,0,2,2,2,0,2,0,0],[1,2,2,0,0,2,0,0,0,2,0,0],[0,0,0,0,0,2,0,0,0,2,0,0],[0,0,0,0,0,2,0,0,0,2,0,0],[0,0,0,0,0,2,0,0,0,2,0,0],[0,0,0,0,0,2,0,0,0,2,0,0],[0,0,0,0,0,2,2,2,2,2,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],this.waypoints=[{x:-100,y:8*48+24},{x:2*48+24,y:8*48+24},{x:2*48+24,y:3*48+24},{x:7*48+24,y:3*48+24},{x:7*48+24,y:8*48-24},{x:5*48+24,y:8*48-24},{x:5*48+24,y:13*48+24},{x:9*48+24,y:13*48+24},{x:9*48+24,y:5*48+24},{x:12*48,y:5*48+24}]}}class K extends T{constructor(t,i,e){super(t,i,e,5),this.cooldown=30,this.maxBullets=2,this.cost=10,this.damage=1,this.bulletSpeed=20,this.colour="#ebc90f"}}var M,C,E,H;class V{constructor(t){g(this,M);g(this,E);this.tiles=t,this.tileSize=48,this.towers=S(this,M,C).call(this),this.goal=S(this,E,H).call(this)}draw(t){for(let i=0;i<this.tiles.length;i++)for(let e=0;e<this.tiles[i].length;e++){let h="#83a904";switch(this.tiles[i][e]){case 1:case 2:h="#d1c99a";break;case 3:h="#c5bb81";break}t.fillStyle=h,t.fillRect(e*this.tileSize,i*this.tileSize,this.tileSize,this.tileSize)}}canPlaceTower(t){return this.tiles[t.y][t.x]===0}}M=new WeakSet,C=function(){const t=[];for(let i=0;i<this.tiles.length;i++)for(let e=0;e<this.tiles[i].length;e++)this.tiles[i][e]===9&&t.push(new K({x:e*this.tileSize,y:i*this.tileSize},this.tileSize,this.tileSize));return t},E=new WeakSet,H=function(){for(let t=0;t<this.tiles.length;t++)for(let i=0;i<this.tiles[t].length;i++)if(this.tiles[t][i]===3)return{position:{x:i*this.tileSize,y:t*this.tileSize},width:this.tileSize,height:this.tileSize}};class l{constructor(t,i,e,h="middle",n="center"){this.position=t,this.text=i,this.textSize=e,this.baseline=h,this.textAlign=n}draw(t){t.fillStyle="white",t.font=`${this.textSize}px sans-serif`,t.textBaseline=this.baseline,t.textAlign=this.textAlign,t.fillText(this.text,this.position.x,this.position.y)}}class y{constructor(t,i,e){if(new.target===y)throw new TypeError("Cannot construct Screen instances directly");this.map=t,this.cursor=e,this.width=i.width,this.height=i.height}update(){}draw(t){}}class X extends y{constructor(t,i,e){super(t,i,e),this.gameOverText=new l({x:this.width/2,y:this.height/2},"Game Over",this.map.tileSize)}draw(t){this.gameOverText.draw(t)}}class J extends y{constructor(t,i,e){super(t,i,e),this.titleText=new l({x:this.width/2,y:this.height/2},"Loading",this.map.tileSize)}draw(t){t.fillStyle="grey",t.fillRect(0,0,this.width,this.height),this.titleText.draw(t)}}class Q{constructor(t,i,e){this.position=t,this.width=i,this.height=e;const h=this.height/3;this.countdownToNextWaveText=new l({x:this.position.x+10,y:this.height/2},"",h,"middle","left"),this.waveText=new l({x:this.position.x+this.width/5+10,y:this.height/2},"",h,"middle","left"),this.livesText=new l({x:this.position.x+2*this.width/5+10,y:this.height/2},"",h,"middle","left"),this.scoreText=new l({x:this.position.x+3*this.width/5+10,y:this.height/2},"",h,"middle","left"),this.coinsText=new l({x:this.position.x+4*this.width/5+10,y:this.height/2},"",h,"middle","left")}draw(t){t.fillStyle="#01962e",t.fillRect(this.position.x,this.position.y,this.width,this.height),this.countdownToNextWaveText.draw(t),this.waveText.draw(t),this.livesText.draw(t),this.scoreText.draw(t),this.coinsText.draw(t)}}class U extends y{constructor(t,i,e){super(t,i,e),this.topbar=new Q({x:0,y:0},this.map.tileSize*this.map.tiles[0].length,this.map.tileSize),this.hoverTile={position:{x:Math.floor(this.cursor.position.x/this.map.tileSize)*this.map.tileSize,y:Math.floor(this.cursor.position.y/this.map.tileSize)*this.map.tileSize},tile:{x:Math.floor(this.cursor.position.x/this.map.tileSize),y:Math.floor(this.cursor.position.y/this.map.tileSize)}},this.active=!1,this.finished=!1}update(){this.hoverTile={position:{x:Math.floor(this.cursor.position.x/this.map.tileSize)*this.map.tileSize,y:Math.floor(this.cursor.position.y/this.map.tileSize)*this.map.tileSize},currentTile:{x:Math.floor(this.cursor.position.x/this.map.tileSize),y:Math.floor(this.cursor.position.y/this.map.tileSize)}}}draw(t){t.fillStyle="#FFFFFF33",t.fillRect(this.hoverTile.position.x,this.hoverTile.position.y,this.map.tileSize,this.map.tileSize),this.topbar.draw(t)}}class Z{constructor(t,i,e,h,n){this.position=t,this.width=i,this.height=e,this.text=h,this.cursor=n,this.hover=!1,this.clicked=!1}update(){this.hover=v.rectRect(this.cursor,this),this.hover&&this.cursor.clicking&&(this.clicked=!0,this.cursor.clicking=!1)}draw(t){t.fillStyle=this.hover?"white":"black",t.fillRect(this.position.x,this.position.y,this.width,this.height),t.fillStyle=this.hover?"black":"white";const i=this.height/3;t.font=`${i}px sans-serif`,t.textBaseline="middle",t.textAlign="center",t.fillText(this.text,this.position.x+this.width/2,this.position.y+this.height/2)}}class _ extends y{constructor(t,i,e){super(t,i,e),this.titleText1=new l({x:this.width/2,y:this.map.tileSize*2.5},"Tower",this.map.tileSize),this.titleText2=new l({x:this.width/2,y:this.map.tileSize*3.5},"Defense",this.map.tileSize),this.instructions1=new l({x:this.width/2,y:this.map.tileSize*5},"Enemies will follow the path to the goal",this.map.tileSize/2.5),this.instructions2=new l({x:this.width/2,y:t.tileSize*5.5},"Towers will try to kill them",t.tileSize/2.5),this.instructions3=new l({x:this.width/2,y:t.tileSize*6.5},"Place towers by tapping on an empty tile",t.tileSize/2.5),this.instructions4=new l({x:this.width/2,y:t.tileSize*7},"Towers cost coins",t.tileSize/2.5),this.instructions5=new l({x:this.width/2,y:t.tileSize*7.5},"Coins are rewarded when an enemy is killed",t.tileSize/2.5),this.instructions6=new l({x:this.width/2,y:t.tileSize*8.5},"If an enemy makes it to the goal you will lose a life",t.tileSize/2.5),this.instructions7=new l({x:this.width/2,y:t.tileSize*9},"Don't lose all your lives!",t.tileSize/2.5);const h=t.tileSize*4;this.playButton=new Z({x:this.width/2-h/2,y:t.tileSize*10},h,t.tileSize*1.5,"Play",this.cursor),this.finished=!1}update(){this.playButton.update(),this.playButton.clicked&&(this.finished=!0)}draw(t){t.fillStyle="grey",t.fillRect(0,0,this.width,this.height),this.titleText1.draw(t),this.titleText2.draw(t),this.instructions1.draw(t),this.instructions2.draw(t),this.instructions3.draw(t),this.instructions4.draw(t),this.instructions5.draw(t),this.instructions6.draw(t),this.instructions7.draw(t),this.playButton.draw(t)}}class tt extends y{constructor(t,i,e){super(t,i,e),this.victoryText=new l({x:this.width/2,y:this.height/2},"You win!",this.map.tileSize)}draw(t){this.victoryText.draw(t)}}class it{constructor(){this.position={x:0,y:0},this.width=1,this.height=1,this.clicking=!1}}class et{constructor(t){this.enemies=t,this.finished=!1}update(){for(let t=0;t<this.enemies.length;t++)this.enemies[t].update()}draw(t){this.enemies.forEach(i=>{i.draw(t)})}}const c=document.querySelector("canvas"),m=c.getContext("2d"),w=new Y,o=new V(w.tiles),u=new it;c.width=o.tiles[0].length*o.tileSize;c.height=o.tiles.length*o.tileSize;let k=3,P=0,z=100,r=0,a=[];const N=359;let f=N;for(let s=0;s<3;s++){const t=[];for(let i=1;i<=33;i+=2)t.push(new I({x:-o.tileSize*i,y:w.waypoints[0].y-o.tileSize/2},o.tileSize,w.waypoints));for(let i=1;i<=17;i+=2)t.push(new $({x:-o.tileSize*i,y:w.waypoints[0].y-o.tileSize/2},o.tileSize,w.waypoints));for(let i=1;i<=9;i+=2)t.push(new D({x:-o.tileSize*i,y:w.waypoints[0].y-o.tileSize/2},o.tileSize,w.waypoints));a.push(new et(t))}let F=0;const st=new X(o,c,u),ht=new J(o,c,u),d=new U(o,c,u),B=new _(o,c,u),ot=new tt(o,c,u),p=new q(ht);function W(){if(F++,requestAnimationFrame(W),B.finished&&p.screen===B&&(p.screen=d,d.active=!0),p.screen===d){if(a[r].enemies.length===0){if(a[r].finished=!0,r++,r>=a.length){p.screen=ot;return}f=N}if(f>0&&f--,f<=0&&a[r].update(),u.clicking){const s=new G({x:d.hoverTile.position.x,y:d.hoverTile.position.y},o.tileSize,o.tileSize);o.canPlaceTower(d.hoverTile.currentTile)&&z>=s.cost&&(o.tiles[d.hoverTile.currentTile.y][d.hoverTile.currentTile.x]=9,o.towers.push(s),z-=s.cost),u.clicking=!1}for(let s=0;s<o.towers.length;s++){o.towers[s].update(F,a[r].enemies);for(let t=0;t<o.towers[s].bullets.length;t++){(o.towers[s].bullets[t].position.x>c.width||o.towers[s].bullets[t].position.x+o.towers[s].bullets[t].radius<0||o.towers[s].bullets[t].position.y<0||o.towers[s].bullets[t].position.y+o.towers[s].bullets[t].radius>c.height)&&(o.towers[s].bullets[t].finished=!0);for(let i=0;i<a[r].enemies.length;i++){if(v.circleRect(o.towers[s].bullets[t],a[r].enemies[i])&&(a[r].enemies[i].health-=o.towers[s].damage,o.towers[s].bullets[t].finished=!0),a[r].enemies[i].health<=0){P++,z+=a[r].enemies[i].coins,a[r].enemies.splice(i,1);continue}if(v.rectRect(a[r].enemies[i],o.goal)){a[r].enemies.splice(i,1),k--;continue}}}}d.topbar.waveText.text=`Wave: ${r+1}`,d.topbar.livesText.text=`Lives: ${k}`,d.topbar.scoreText.text=`Score: ${P}`,d.topbar.coinsText.text=`Coins: ${z}`,d.topbar.countdownToNextWaveText.text=`Next: ${Math.floor(f/60)}`,k===0&&(p.screen=st)}p.screen.update(),o.draw(m),o.towers.forEach(s=>{s.draw(m)}),a.forEach(s=>{s.draw(m)}),p.screen.draw(m)}window.addEventListener("load",()=>{p.screen=B});c.addEventListener("mousemove",s=>{u.position={x:s.layerX,y:s.layerY}});c.addEventListener("touchstart",()=>{u.clicking=!0});c.addEventListener("mousedown",()=>{u.clicking=!0});c.addEventListener("mouseup",()=>{u.clicking=!1});c.addEventListener("touchend",()=>{u.clicking=!1});W();
